<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ | PKSH æ•¸ä½å¹³å°</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- å»ºè­°å­—é«”è¨­å®š (ä½¿ç”¨ç³»çµ±å­—é«”ï¼Œç¢ºä¿ç¹é«”ä¸­æ–‡é¡¯ç¤ºæ­£ç¢º) -->
    <style>
        :root {
            --phsa-red: #E63946;
            --phsa-blue: #457B9D;
            font-family: 'Noto Sans TC', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        .bg-phsa-red { background-color: var(--phsa-red); }
        .text-phsa-red { color: var(--phsa-red); }
        .border-phsa-red { border-color: var(--phsa-red); }
        /* è‡ªå®šç¾©å¡ç‰‡é™°å½± */
        .card-shadow { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1); }
        /* è·‘é¦¬ç‡ˆæ•ˆæœ */
        .marquee-container { overflow: hidden; white-space: nowrap; }
        .marquee-content { display: inline-block; animation: marquee 15s linear infinite; }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        /* ç”³è¨´ç‹€æ…‹æ¢æ¨£å¼ */
        .status-step.active .status-dot { background-color: var(--phsa-red); }
        .status-step.active .status-text { font-weight: 600; color: #1f2937; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- é ‚éƒ¨è·‘é¦¬ç‡ˆ Banner -->
    <div class="bg-gray-900 text-white text-sm py-2 px-4 marquee-container">
        <div class="marquee-content flex space-x-8">
            <span id="ticker-content" class="flex-shrink-0">
                æœ€æ–°æ¶ˆæ¯ï¼šğŸ€ ç±ƒçƒè³½å ±åæˆªæ­¢å€’æ•¸ 3 å¤©ï¼è«‹å„˜é€Ÿæäº¤ | ğŸµ åˆé¤é»æ­Œå¯©æ ¸é€šéæ•¸ï¼š12 é¦– | ğŸ“¢ æ¬Šç›Šç”³è¨´æ¡ˆä»¶ #C005 å·²çµæ¡ˆï¼
            </span>
            <span class="flex-shrink-0">
                æœ€æ–°æ¶ˆæ¯ï¼šğŸ€ ç±ƒçƒè³½å ±åæˆªæ­¢å€’æ•¸ 3 å¤©ï¼è«‹å„˜é€Ÿæäº¤ | ğŸµ åˆé¤é»æ­Œå¯©æ ¸é€šéæ•¸ï¼š12 é¦– | ğŸ“¢ æ¬Šç›Šç”³è¨´æ¡ˆä»¶ #C005 å·²çµæ¡ˆï¼
            </span>
        </div>
    </div>

    <!-- Header & å°è¦½åˆ— -->
    <header class="sticky top-0 z-10 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Title -->
                <a href="#" class="flex-shrink-0 flex items-center" onclick="navigate('home')">
                    <span class="text-2xl font-bold text-phsa-red">PKSH</span>
                    <span class="ml-2 text-gray-900 hidden sm:inline">åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ</span>
                </a>

                <!-- å°è¦½é¸å–® (Desktop) -->
                <nav class="hidden md:flex space-x-6">
                    <button class="text-gray-600 hover:text-phsa-red transition-colors" onclick="navigate('home')">é¦–é </button>
                    <button class="text-gray-600 hover:text-phsa-red transition-colors" onclick="navigate('complaint')">ç”³è¨´ä¿¡ç®±</button>
                    <button class="text-gray-600 hover:text-phsa-red transition-colors" onclick="navigate('clubs')">ç¤¾åœ˜å°ˆå€</button>
                    <a href="#admin" class="text-gray-600 hover:text-phsa-red transition-colors" onclick="navigate('admin')">å¹¹éƒ¨ç™»å…¥</a>
                    <!-- TODO: API æ›¿æ›é» - ç¤¾ç¾¤é€£çµ -->
                    <a href="https://www.instagram.com/pksh" target="_blank" class="text-gray-600 hover:text-phsa-red transition-colors">
                        <i data-lucide="instagram" class="w-5 h-5"></i>
                    </a>
                </nav>

                <!-- æ¼¢å ¡é¸å–® (Mobile) -->
                <button id="menu-button" class="md:hidden text-gray-600 hover:text-phsa-red">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu å±•é–‹å…§å®¹ -->
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-100">
            <div class="px-4 pt-2 pb-4 space-y-1 sm:px-6">
                <button class="block w-full text-left py-2 px-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50" onclick="navigate('home')">é¦–é </button>
                <button class="block w-full text-left py-2 px-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50" onclick="navigate('complaint')">ç”³è¨´ä¿¡ç®±</button>
                <button class="block w-full text-left py-2 px-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50" onclick="navigate('clubs')">ç¤¾åœ˜å°ˆå€</button>
                <a href="#admin" class="block py-2 px-3 rounded-md text-base font-medium bg-phsa-red text-white hover:bg-red-700 transition-colors" onclick="navigate('admin')">å¹¹éƒ¨ç™»å…¥</a>
            </div>
        </div>
    </header>

    <!-- ä¸»å…§å®¹å€å¡Š -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8" id="app-container">
        <!-- å…§å®¹å°‡ç”± JavaScript å‹•æ…‹æ’å…¥ -->
        <!-- è¼‰å…¥ä¸­çš„æç¤º -->
        <div id="loading-spinner" class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-phsa-red"></div>
            <p class="ml-4 text-gray-500">ç³»çµ±è¼‰å…¥ä¸­...</p>
        </div>
    </main>

    <!-- ç¶²ç«™ Footer -->
    <footer class="bg-gray-100 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-600">
            <p>Â© 2025 åœ‹ç«‹åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ (PKSH). All Rights Reserved.</p>
            <p>æœ¬ç¶²ç«™ç”±å­¸ç”Ÿæœƒè³‡è¨Šçµ„ç¶­è­·ï¼Œå»ºè­°ä½¿ç”¨ Chrome/Safari ç€è¦½å™¨ã€‚</p>
        </div>
    </footer>

    <script type="module">
        // å¼•å…¥ Firebase å¿…è¦çš„æ¨¡çµ„
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- æ ¸å¿ƒè³‡æ–™èˆ‡ç‹€æ…‹ ---

        const APP_STATE = {
            view: 'home',
            trackingId: null,
            // Firebase ç‹€æ…‹
            authReady: false,
            isAdmin: false, // è¿½è¹¤æ˜¯å¦ç‚ºç®¡ç†å“¡
            userId: null,
            // æ¨¡æ“¬è³‡æ–™ (å°‡é€æ­¥è¢« Firestore å–ä»£)
            mockData: {
                announcements: [
                    { id: 1, title: 'æ ¡æ…¶åœ’éŠæœƒæ”¤ä½æ‹›å‹Ÿï¼', tag: 'æ´»å‹•', date: '2025-11-20', content: 'ä¸€å¹´ä¸€åº¦çš„æ ¡æ…¶åœ’éŠæœƒå³å°‡ç™»å ´ï¼Œå¿«ä¾†ç”³è«‹æ”¤ä½ï¼' },
                    { id: 2, title: 'æ–°ç‰ˆæ ¡è¦æ„è¦‹æ”¶é›†', tag: 'æ¬Šç›Š', date: '2025-11-15', content: 'æ•™å‹™è™•å°‡ä¿®è¨‚æ ¡è¦ï¼Œè«‹å­¸ç”Ÿä»£è¡¨è¸´èºæä¾›æ„è¦‹ã€‚' },
                    { id: 3, title: 'é«˜äºŒç¤¾åœ˜æˆæœå±•æ™‚é–“å…¬å‘Š', tag: 'ç¤¾åœ˜', date: '2025-11-10', content: 'è«‹å„ç¤¾åœ˜ç•™æ„æ™‚é–“ï¼Œé–‹å§‹æº–å‚™å±•ç¤ºå…§å®¹ã€‚' },
                    { id: 4, title: 'å­¸ç”Ÿæœƒ 11 æœˆä»½æœƒè­°è¨˜éŒ„å…¬é–‹', tag: 'æœƒè­°', date: '2025-11-05', content: 'æ¬²çŸ¥è©³æƒ…ï¼Œè«‹ç™»å…¥å¾Œå°æŸ¥é–±æª”æ¡ˆã€‚' },
                ],
                clubs: [
                    { id: 'C01', name: 'å‰ä»–ç¤¾', category: 'è—æ–‡', desc: 'ç”¨éŸ³æ¨‚æ„Ÿå‹•ä¸–ç•Œï¼Œç¤¾èª²æ™‚é–“ï¼šé€±ä¸‰ä¸‹åˆã€‚', leader: 'é™³å°æ˜', imageUrl: 'https://placehold.co/400x250/E63946/FFFFFF?text=Guitar' },
                    { id: 'C02', name: 'ç±ƒçƒç¤¾', category: 'é‹å‹•', desc: 'ç†±è¡€æ²¸é¨°ï¼Œé¬¥ç‰›è³½ç­‰ä½ ä¾†æˆ°ï¼', leader: 'æ—å¤§è¯', imageUrl: 'https://placehold.co/400x250/457B9D/FFFFFF?text=Basketball' },
                    { id: 'C03', name: 'ç¶ è‰²å¤§åœ°æœå‹™éšŠ', category: 'æœå‹™', desc: 'ç‚ºæ ¡åœ’ç’°å¢ƒç›¡ä¸€ä»½å¿ƒåŠ›ã€‚', leader: 'ç‹ç¾æƒ ', imageUrl: 'https://placehold.co/400x250/A8DADC/FFFFFF?text=Service' },
                ],
                clubApplications: [
                    { id: 'A001', club: 'ç†±èˆç¤¾', activity: 'å¹´åº¦å…¬æ¼”', status: 'å·²æ”¶ä»¶', date: '2025-11-25' },
                    { id: 'A002', club: 'æ”å½±ç¤¾', activity: 'æœŸæœ«ä½œå“å±•', status: 'è²¡å‹™å¯©æ ¸ä¸­', date: '2025-11-24' },
                ],
                complaints: {
                    'C001': { status: 'å·²çµæ¡ˆ', category: 'è¨­å‚™', content: 'å®¿èˆé£²æ°´æ©Ÿæ•…éšœã€‚', adminReply: 'ç¸½å‹™è™•å·²æ´¾å“¡ç¶­ä¿®ä¸¦æ›´æ›æ¿¾å¿ƒï¼Œè«‹åŒå­¸å†æ¬¡ç¢ºèªã€‚' },
                    'C002': { status: 'è™•ç†ä¸­', category: 'æ•™å‹™', content: 'è‹±æ–‡èª²æœ¬å…§å®¹å¤ªé›£ï¼Œå¸Œæœ›èª¿æ•´ã€‚', adminReply: 'å·²è½‰äº¤æ•™å‹™è™•èª²ç ”çµ„ï¼Œè«‹ä»£è¡¨æŒçºŒè¿½è¹¤ã€‚' },
                    'C003': { status: 'å·²æ”¶åˆ°', category: 'ç”Ÿæ´»', content: 'åˆä½œç¤¾éºµåŒ…å¸¸å¸¸è³£å…‰ã€‚' },
                },
                confessions: [
                    { id: 1, message: 'è‡´ G201 çš„é‚£ä½ï¼Œä½ ç¬‘èµ·ä¾†åƒå¤ªé™½ï¼â˜€ï¸', nick: 'åŒ¿åå­¸ç”Ÿ A', status: 'approved' },
                    { id: 2, message: 'æ„Ÿè¬å­¸ç”Ÿæœƒè®“ç±ƒçƒæ¶ä¿®å¥½äº†ï¼', nick: 'ç±ƒçƒç‹‚ç†±è€…', status: 'approved' }
                ]
            }
        };

        let app;
        let db;
        let auth;
        const ADMIN_EMAIL = 'admin@pksh.edu.tw'; // ç®¡ç†å“¡å°ˆç”¨ Email

        // --- Firebase åˆå§‹åŒ–èˆ‡èªè­‰ ---
        function initFirebaseAndAuth() {
            try {
                // ä½¿ç”¨è€…æä¾›çš„çœŸå¯¦ Firebase è¨­å®š
                const firebaseConfig = {
                  apiKey: "AIzaSyDWmy__e9_7YbhBTJNvLvGVglj-fOTFWMg",
                  authDomain: "pksh-student-council.firebaseapp.com",
                  projectId: "pksh-student-council",
                  storageBucket: "pksh-student-council.firebasestorage.app",
                  messagingSenderId: "142500679754",
                  appId: "1:142500679754:web:a758dc9a8b5ae34f9296b3"
                };

                // 1. åˆå§‹åŒ– Firebase App
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // å˜—è©¦åŒ¿åç™»å…¥ (ç¢ºä¿ä¸€èˆ¬è¨ªå®¢ä¹Ÿèƒ½é€£ç·š)
                // è«‹ç¢ºä¿åœ¨ Firebase Console é–‹å•Ÿã€ŒåŒ¿å (Anonymous)ã€ç™»å…¥
                signInAnonymously(auth).catch(error => {
                    console.warn("Anonymous sign-in failed. Guests might not see real-time data.", error);
                });

                // 2. ç›£è½èº«ä»½é©—è­‰ç‹€æ…‹è®ŠåŒ–
                onAuthStateChanged(auth, (user) => {
                    // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥ (ç„¡è«–æ˜¯åŒ¿åæˆ– Email/Password)
                    if (user) {
                        APP_STATE.userId = user.uid;
                        // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡ (é€™è£¡æˆ‘å€‘å°‡ admin ç™»å…¥è¦–ç‚ºç‰¹æ®Šæ¬Šé™)
                        APP_STATE.isAdmin = (user.email === ADMIN_EMAIL && !user.isAnonymous); 
                    } else {
                        APP_STATE.userId = null;
                        APP_STATE.isAdmin = false;
                    }
                    
                    if (!APP_STATE.authReady) {
                        APP_STATE.authReady = true;
                        // é¦–æ¬¡è¼‰å…¥å®Œæˆï¼Œç§»é™¤è¼‰å…¥å‹•ç•«ä¸¦å°èˆªåˆ°é¦–é 
                        const loadingSpinner = document.getElementById('loading-spinner');
                        if (loadingSpinner) loadingSpinner.remove();
                        navigate('home');
                    }
                    console.log("Auth State Changed. User ID:", APP_STATE.userId, "Is Admin:", APP_STATE.isAdmin);
                });
            } catch (e) {
                console.error("Failed to initialize Firebase:", e);
                // å³ä½¿å¤±æ•—ï¼Œä¹Ÿå˜—è©¦å°èˆªï¼Œä½†åŠŸèƒ½æœƒå—é™
                APP_STATE.authReady = true;
                const loadingSpinner = document.getElementById('loading-spinner');
                if (loadingSpinner) loadingSpinner.remove();
                navigate('home');
            }
        }
        
        // --- View æ¸²æŸ“å‡½æ•¸ ---

        const appContainer = document.getElementById('app-container');

        // è¼”åŠ©å‡½æ•¸: æª¢æŸ¥èªè­‰ç‹€æ…‹
        function checkAuthAndRender(renderFunction) {
             if (!APP_STATE.authReady) return; // é¿å…åœ¨èªè­‰å®Œæˆå‰æ¸²æŸ“

             // ç¢ºä¿åœ¨å°èˆªåˆ° admin é é¢æ™‚ï¼Œç”¨æˆ¶ç¢ºå¯¦æ˜¯ admin
             if (APP_STATE.view === 'admin' && !APP_STATE.isAdmin) {
                 renderAdminLogin(); // æœªç™»å…¥æˆ–ä¸æ˜¯ admin å‰‡é¡¯ç¤ºç™»å…¥ä»‹é¢
                 return;
             }
             
             renderFunction();
        }

        // 1. Home é é¢æ¸²æŸ“
        function renderHome() {
            const newsHtml = APP_STATE.mockData.announcements.map(item => `
                <div class="bg-white p-5 rounded-xl card-shadow transition-transform hover:scale-[1.01]">
                    <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full ${item.tag === 'æ´»å‹•' ? 'bg-phsa-red text-white' : item.tag === 'æ¬Šç›Š' ? 'bg-phsa-blue text-white' : 'bg-gray-200 text-gray-700'}">${item.tag}</span>
                    <h3 class="text-xl font-bold mt-2 text-gray-900">${item.title}</h3>
                    <p class="text-sm text-gray-500 mt-1">${item.date}</p>
                    <!-- TODO: API æ›¿æ›é» - å…¬å‘Šè©³ç´°å…§å®¹é€£çµ -->
                    <a href="#" class="mt-3 text-phsa-red font-semibold flex items-center hover:underline" onclick="event.preventDefault(); alert('é»æ“ŠæŸ¥çœ‹è©³ç´°å…§å®¹ (æ¨¡æ“¬)');">
                        é–±è®€è©³æƒ… <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                    </a>
                </div>
            `).join('');

            const confession = APP_STATE.mockData.confessions.find(c => c.status === 'approved') || { message: 'æš«ç„¡æœ€æ–°å‘Šç™½', nick: 'ç³»çµ±' };

            appContainer.innerHTML = `
                <!-- Hero Banner -->
                <div class="bg-phsa-red text-white rounded-2xl p-6 lg:p-12 mb-10 card-shadow">
                    <h1 class="text-4xl lg:text-5xl font-extrabold mb-4">åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿè‡ªæ²»</h1>
                    <p class="text-lg lg:text-xl opacity-90">ä½ çš„è²éŸ³ï¼Œæˆ‘å€‘çš„è¡Œå‹•ã€‚å…±å‰µæ›´ç¾å¥½çš„æ ¡åœ’ç”Ÿæ´»ã€‚</p>
                    <button class="mt-6 bg-white text-phsa-red font-bold py-3 px-6 rounded-full hover:bg-gray-100 transition-colors" onclick="navigate('complaint')">
                        ç«‹å³ç”³è¨´/å»ºè­°
                    </button>
                </div>

                <!-- å¿«é€Ÿé€£çµ (Quick Links) -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">å¿«é€Ÿè¡Œå‹•</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button class="p-6 bg-white rounded-xl card-shadow border-t-4 border-phsa-red text-center hover:bg-gray-50 transition-colors" onclick="navigate('complaint')">
                            <i data-lucide="shield-question" class="w-8 h-8 mx-auto text-phsa-red mb-2"></i>
                            <span class="font-semibold text-gray-900">æ¬Šç›Šç”³è¨´</span>
                        </button>
                        <a href="#register" class="p-6 bg-white rounded-xl card-shadow border-t-4 border-phsa-blue text-center hover:bg-gray-50 transition-colors" onclick="event.preventDefault(); alert('TODO: æ¥å…¥å ±åç³»çµ± API');">
                            <i data-lucide="ticket" class="w-8 h-8 mx-auto text-phsa-blue mb-2"></i>
                            <span class="font-semibold text-gray-900">æ´»å‹•å ±å</span>
                        </a>
                        <button class="p-6 bg-white rounded-xl card-shadow border-t-4 border-gray-400 text-center hover:bg-gray-50 transition-colors" onclick="navigate('clubs')">
                            <i data-lucide="users" class="w-8 h-8 mx-auto text-gray-600 mb-2"></i>
                            <span class="font-semibold text-gray-900">ç¤¾åœ˜æŸ¥è©¢</span>
                        </button>
                        <a href="#downloads" class="p-6 bg-white rounded-xl card-shadow border-t-4 border-gray-400 text-center hover:bg-gray-50 transition-colors" onclick="event.preventDefault(); alert('TODO: æª”æ¡ˆä¸‹è¼‰ä¸­å¿ƒ');">
                            <i data-lucide="download" class="w-8 h-8 mx-auto text-gray-600 mb-2"></i>
                            <span class="font-semibold text-gray-900">æª”æ¡ˆä¸‹è¼‰</span>
                        </a>
                    </div>
                </section>

                <!-- å…¬å‘Šèˆ‡å‘Šç™½ç‰† -->
                <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-bold mb-4 text-gray-900">æœ€æ–°å…¬å‘Š</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${newsHtml}
                        </div>
                        <!-- TODO: API æ›¿æ›é» - æ›´å¤šå…¬å‘Šé€£çµ -->
                        <div class="text-center mt-6">
                             <a href="#" class="text-phsa-red font-semibold hover:underline">æŸ¥çœ‹æ›´å¤šå…¬å‘Š...</a>
                        </div>
                    </div>

                    <!-- åŒ¿åå‘Šç™½ç‰† (å´é‚Šæ¬„/å¡ç‰‡) -->
                    <div class="bg-white p-6 rounded-xl card-shadow h-fit">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-phsa-red flex items-center">
                                <i data-lucide="heart" class="w-5 h-5 mr-2 fill-phsa-red"></i> åŒ¿åå‘Šç™½ç‰†
                            </h2>
                            <a href="#" class="text-sm text-gray-500 hover:text-phsa-red" onclick="event.preventDefault(); alert('TODO: æäº¤å‘Šç™½è¡¨å–®');">æäº¤å‘Šç™½</a>
                        </div>
                        <div class="text-gray-700 italic border-l-4 border-phsa-blue pl-4 py-2 bg-gray-50 rounded-md">
                            <p class="text-lg">${confession.message}</p>
                            <p class="text-right text-sm mt-2">- ${confession.nick}</p>
                        </div>
                    </div>
                </section>
            `;
            lucide.createIcons(); // é‡æ–°æ¸²æŸ“ Lucide åœ–æ¨™
        }

        // 2. ç”³è¨´ä¿¡ç®±é é¢æ¸²æŸ“
        function renderComplaint() {
            appContainer.innerHTML = `
                <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl card-shadow">
                    <h1 class="text-3xl font-bold mb-6 text-phsa-red">æ¬Šç›Šç”³è¨´/å»ºè­°ä¿¡ç®±</h1>

                    <!-- å°èˆª Tab: ç”³è¨´æäº¤ / ç‹€æ…‹è¿½è¹¤ -->
                    <div class="flex border-b mb-6">
                        <button id="tab-submit" class="tab-button py-2 px-4 text-lg font-medium border-b-2 border-phsa-red text-phsa-red transition-colors" onclick="showComplaintSection('submit')">æäº¤ç”³è¨´</button>
                        <button id="tab-track" class="tab-button py-2 px-4 text-lg font-medium border-b-2 border-transparent text-gray-500 hover:text-phsa-red transition-colors" onclick="showComplaintSection('track')">é€²åº¦è¿½è¹¤</button>
                    </div>

                    <!-- ç”³è¨´æäº¤å€å¡Š -->
                    <div id="complaint-submit-section">
                        <form id="complaint-form" onsubmit="handleComplaintSubmit(event)">
                            <p class="mb-4 text-gray-600 flex items-center">
                                <i data-lucide="alert-triangle" class="w-5 h-5 mr-2 text-yellow-500"></i>
                                æœ¬ç³»çµ±å®Œå…¨åŒ¿åï¼Œè«‹å‹¿åœ¨å…§å®¹ä¸­å¡«å¯«å€‹äººè³‡æ–™ã€‚ç³»çµ±å°‡æä¾›è¿½è¹¤ç¢¼ä¾›æ‚¨æŸ¥è©¢é€²åº¦ã€‚
                            </p>
                            <div class="mb-4">
                                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">ç”³è¨´é¡åˆ¥ (å¿…é¸)</label>
                                <select id="category" name="category" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red">
                                    <option value="">è«‹é¸æ“‡...</option>
                                    <option value="equipment">è¨­å‚™è¨­æ–½ (å¦‚é£²æ°´æ©Ÿã€å»æ‰€)</option>
                                    <option value="curriculum">æ•™å‹™ç›¸é—œ (å¦‚èª²è¡¨ã€è€ƒè©¦)</option>
                                    <option value="rights">å­¸ç”Ÿæ¬Šç›Š (å¦‚æ ¡è¦ã€æœå„€)</option>
                                    <option value="life">ç”Ÿæ´»ç›¸é—œ (å¦‚åˆé¤ã€åˆä½œç¤¾)</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label for="content" class="block text-sm font-medium text-gray-700 mb-1">ç”³è¨´å…§å®¹ (å¿…å¡«)</label>
                                <textarea id="content" name="content" rows="6" required placeholder="è«‹è©³ç´°æè¿°å•é¡Œç™¼ç”Ÿçš„æ™‚é–“ã€åœ°é»åŠå½±éŸ¿..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red"></textarea>
                                <p class="text-xs text-gray-500 mt-1">å…§å®¹éœ€å¤§æ–¼ 20 å­—ï¼Œå°æ–¼ 1000 å­—ã€‚</p>
                            </div>
                            <button type="submit" class="w-full bg-phsa-red text-white font-semibold py-3 rounded-lg hover:bg-red-700 transition-colors">
                                æäº¤ç”³è¨´
                            </button>
                        </form>
                    </div>

                    <!-- ç‹€æ…‹è¿½è¹¤å€å¡Š -->
                    <div id="complaint-track-section" class="hidden">
                        <div id="tracking-info" class="mb-6 bg-gray-50 p-4 rounded-lg text-gray-700">
                             è«‹è¼¸å…¥æ‚¨çš„è¿½è¹¤ ID æŸ¥è©¢ç”³è¨´é€²åº¦ï¼Œ**æœ¬ç³»çµ±ç„¡éœ€ PIN ç¢¼ï¼Œåƒ…éœ€ ID** (æ¨¡æ“¬ç°¡åŒ–)ã€‚
                        </div>
                        <form id="tracking-form" onsubmit="handleTrackingSubmit(event)">
                            <div class="flex space-x-2">
                                <input type="text" id="track-id" placeholder="è«‹è¼¸å…¥è¿½è¹¤ ID (ä¾‹: C001)" required class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red uppercase">
                                <button type="submit" class="bg-phsa-blue text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                                    æŸ¥è©¢
                                </button>
                            </div>
                        </form>
                        <div id="tracking-result" class="mt-8">
                            <!-- æŸ¥è©¢çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
            // æ ¹æ“šç‹€æ…‹æ¢é‡è¨­ active ç‹€æ…‹
            if (APP_STATE.trackingId) {
                showComplaintSection('track');
                document.getElementById('track-id').value = APP_STATE.trackingId;
                handleTrackingSubmit({ preventDefault: () => {} });
            } else {
                showComplaintSection('submit');
            }
        }

        // 3. ç¤¾åœ˜å°ˆå€é é¢æ¸²æŸ“
        function renderClubs() {
            const categories = ['å…¨éƒ¨', 'è—æ–‡', 'é‹å‹•', 'æœå‹™', 'å­¸è¡“'];
            const categoryHtml = categories.map(cat => `
                <button class="px-4 py-2 rounded-full text-sm font-medium border border-gray-300 hover:bg-phsa-red hover:text-white transition-colors" data-category="${cat}" onclick="filterClubs('${cat}')">
                    ${cat}
                </button>
            `).join('');

            const clubHtml = APP_STATE.mockData.clubs.map(club => `
                <div class="bg-white rounded-xl card-shadow overflow-hidden transition-all hover:shadow-lg">
                    <img src="${club.imageUrl}" alt="${club.name} å®£å‚³åœ–" class="w-full h-40 object-cover">
                    <div class="p-5">
                        <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-gray-200 text-gray-700">${club.category}</span>
                        <h3 class="text-xl font-bold mt-2 text-gray-900">${club.name}</h3>
                        <p class="text-gray-600 text-sm mt-1">${club.desc}</p>
                        <div class="mt-4 flex justify-between items-center">
                            <span class="text-sm text-gray-500">ç¤¾é•·: ${club.leader}</span>
                            <a href="#" class="text-phsa-red font-semibold hover:underline text-sm" onclick="event.preventDefault(); alert('TODO: å°å‘ç¤¾åœ˜è©³ç´°é é¢');">
                                äº†è§£æ›´å¤š <i data-lucide="chevron-right" class="w-4 h-4 inline-block"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            appContainer.innerHTML = `
                <h1 class="text-3xl font-bold mb-6 text-phsa-red">ç¤¾åœ˜å°ˆå€ (Club Directory)</h1>

                <!-- æœå°‹èˆ‡ç¯©é¸ -->
                <div class="mb-8 p-6 bg-white rounded-xl card-shadow">
                    <input type="text" placeholder="è¼¸å…¥ç¤¾åœ˜åç¨±æˆ–é—œéµå­—æœå°‹..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red mb-4">
                    <div class="flex flex-wrap gap-2" id="club-category-filters">
                        ${categoryHtml}
                    </div>
                </div>

                <!-- ç¤¾åœ˜åˆ—è¡¨ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="club-list">
                    ${clubHtml}
                </div>
                <!-- TODO: API æ›¿æ›é» - ç¤¾åœ˜åˆ—è¡¨ API -->
            `;
            lucide.createIcons();
        }

        // 4. å¾Œå°ç™»å…¥/å„€è¡¨æ¿ (Mock) é é¢æ¸²æŸ“
        function renderAdmin() {
            if (APP_STATE.isAdmin) {
                renderAdminDashboard();
                return;
            }
            renderAdminLogin(); // å¦‚æœä¸æ˜¯ Admin å‰‡é¡¯ç¤ºç™»å…¥é é¢
        }

        function renderAdminLogin() {
            appContainer.innerHTML = `
                <div class="max-w-md mx-auto bg-white p-8 rounded-xl card-shadow mt-10">
                    <h1 class="text-3xl font-bold mb-6 text-center text-phsa-red">å¹¹éƒ¨ç™»å…¥</h1>
                    <form onsubmit="handleAdminLogin(event)">
                        <div class="mb-4">
                            <label for="admin-email" class="block text-sm font-medium text-gray-700 mb-1">å­¸æ ¡ Email</label>
                            <input type="email" id="admin-email" value="${ADMIN_EMAIL}" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red">
                        </div>
                        <div class="mb-6">
                            <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç¢¼</label>
                            <input type="password" id="admin-password" value="123456" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-phsa-red focus:border-phsa-red">
                        </div>
                        <button type="submit" class="w-full bg-phsa-red text-white font-semibold py-3 rounded-lg hover:bg-red-700 transition-colors">
                            ç™»å…¥å¾Œå°
                        </button>
                        <p id="login-message" class="text-center text-sm mt-4 text-red-500"></p>
                    </form>
                    <p class="text-xs text-center text-gray-400 mt-4">æ³¨æ„ï¼šæ­¤ç™»å…¥ä½¿ç”¨ Firebase Email/Password é©—è­‰ã€‚</p>
                </div>
            `;
        }


        // 4.1 Admin Dashboard æ¨¡æ“¬
        function renderAdminDashboard() {
             const complaintsPending = Object.values(APP_STATE.mockData.complaints).filter(c => c.status === 'å·²æ”¶åˆ°').length;
             const applicationsPending = APP_STATE.mockData.clubApplications.filter(a => a.status === 'å·²æ”¶ä»¶').length;
            
             appContainer.innerHTML = `
                <h1 class="text-3xl font-bold mb-6 text-phsa-red">å„€è¡¨æ¿ (Admin)</h1>
                <p class="mb-6 text-green-600 font-semibold">æ‚¨å·²ä»¥ç®¡ç†å“¡èº«ä»½ ${auth.currentUser.email} ç™»å…¥ã€‚</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- å¡ç‰‡ 1: å¾…è™•ç†ç”³è¨´ -->
                    <div class="bg-white p-6 rounded-xl card-shadow border-l-4 border-phsa-red">
                        <p class="text-sm font-medium text-phsa-red">å¾…è™•ç†ç”³è¨´</p>
                        <p class="text-3xl font-bold mt-1">${complaintsPending}</p>
                        <a href="#" class="text-sm text-gray-500 hover:text-phsa-red">æŸ¥çœ‹æ‰€æœ‰æ¡ˆä»¶</a>
                    </div>
                    <!-- å¡ç‰‡ 2: ç¤¾åœ˜ç”³è«‹ -->
                    <div class="bg-white p-6 rounded-xl card-shadow border-l-4 border-phsa-blue">
                        <p class="text-sm font-medium text-phsa-blue">å¾…å¯©æ ¸ç”³è«‹</p>
                        <p class="text-3xl font-bold mt-1">${applicationsPending}</p>
                        <a href="#" class="text-sm text-gray-500 hover:text-phsa-blue">å¯©æ ¸ç¤¾åœ˜æ´»å‹•</a>
                    </div>
                    <!-- å¡ç‰‡ 3: å…¬å‘Šç™¼å¸ƒ -->
                    <div class="bg-white p-6 rounded-xl card-shadow border-l-4 border-gray-500">
                        <p class="text-sm font-medium text-gray-500">ç™¼å¸ƒæ–°å…¬å‘Š</p>
                        <p class="text-3xl font-bold mt-1">ğŸ“</p>
                        <a href="#" class="text-sm text-gray-500 hover:text-gray-900">é€²å…¥ç·¨è¼¯å™¨</a>
                    </div>
                </div>

                <!-- æ¨¡æ“¬ç”³è¨´æ¡ˆä»¶åˆ—è¡¨ -->
                <div class="bg-white p-6 rounded-xl card-shadow mb-8">
                    <h2 class="text-xl font-bold mb-4 text-gray-900">ç”³è¨´æ¡ˆä»¶è¿½è¹¤ (æ¬Šç›Šçµ„)</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">é¡åˆ¥</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç‹€æ…‹</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${Object.keys(APP_STATE.mockData.complaints).map(key => {
                                const c = APP_STATE.mockData.complaints[key];
                                return `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${key}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.category}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c.status === 'å·²çµæ¡ˆ' ? 'bg-green-100 text-green-800' : c.status === 'è™•ç†ä¸­' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                                ${c.status}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button class="text-phsa-red hover:text-red-900" onclick="alert('TODO: é€²å…¥æ¡ˆä»¶å›è¦†ä»‹é¢')">è™•ç†</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>

                <button class="text-gray-500 hover:text-gray-900 mt-4 text-sm" onclick="handleAdminLogout()">
                    <i data-lucide="log-out" class="w-4 h-4 inline-block mr-1"></i> ç™»å‡º
                </button>
            `;
             lucide.createIcons();
        }

        // --- äº’å‹•é‚è¼¯å‡½æ•¸ ---

        // é é¢å°èˆª
        function navigate(view) {
            APP_STATE.view = view;
            APP_STATE.trackingId = null; // æ¸…é™¤è¿½è¹¤ ID ç‹€æ…‹
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.add('hidden');
            }

            // ç¢ºä¿èªè­‰å®Œæˆå¾Œæ‰é–‹å§‹æ¸²æŸ“
            if (!APP_STATE.authReady) {
                // å¦‚æœèªè­‰æœªå®Œæˆï¼Œå‰‡ä¸åšä»»ä½•äº‹ï¼Œç­‰å¾… onAuthStateChanged è§¸ç™¼
                return;
            }

            switch (view) {
                case 'complaint':
                    checkAuthAndRender(renderComplaint);
                    break;
                case 'clubs':
                    checkAuthAndRender(renderClubs);
                    break;
                case 'admin':
                    checkAuthAndRender(renderAdmin); // é€™è£¡æœƒæª¢æŸ¥æ˜¯å¦ç‚º adminï¼Œä¸æ˜¯å‰‡å°å‘ç™»å…¥é 
                    break;
                default:
                    checkAuthAndRender(renderHome);
                    break;
            }
            window.scrollTo(0, 0); // å›åˆ°é ‚éƒ¨
        }
        
        // ç”³è¨´é é¢ Tab åˆ‡æ›
        function showComplaintSection(section) {
            const submit = document.getElementById('complaint-submit-section');
            const track = document.getElementById('complaint-track-section');
            const tabSubmit = document.getElementById('tab-submit');
            const tabTrack = document.getElementById('tab-track');

            if (section === 'submit') {
                submit.classList.remove('hidden');
                track.classList.add('hidden');
                tabSubmit.classList.add('border-phsa-red', 'text-phsa-red');
                tabSubmit.classList.remove('border-transparent', 'text-gray-500');
                tabTrack.classList.remove('border-phsa-red', 'text-phsa-red');
                tabTrack.classList.add('border-transparent', 'text-gray-500');
            } else if (section === 'track') {
                submit.classList.add('hidden');
                track.classList.remove('hidden');
                tabTrack.classList.add('border-phsa-red', 'text-phsa-red');
                tabTrack.classList.remove('border-transparent', 'text-gray-500');
                tabSubmit.classList.remove('border-phsa-red', 'text-phsa-red');
                tabSubmit.classList.add('border-transparent', 'text-gray-500');
            }
        }

        // ç”³è¨´æäº¤è™•ç†
        function handleComplaintSubmit(event) {
            event.preventDefault();
            const category = document.getElementById('category').value;
            const content = document.getElementById('content').value.trim();

            if (content.length < 20) {
                 // ä½¿ç”¨ custom modal è€Œé alert
                 console.log('è«‹æä¾›æ›´è©³ç´°çš„ç”³è¨´å…§å®¹ (è‡³å°‘ 20 å€‹å­—)ã€‚');
                 return;
            }

            // --- API æ›¿æ›é»: POST /api/complaints (æœªä¾†ä½¿ç”¨ Firestore) ---
            // æ¨¡æ“¬å¾Œç«¯å›å‚³ Tracking ID
            const newId = 'C' + Math.floor(Math.random() * 900 + 100); 

            // æ¨¡æ“¬æˆåŠŸå›é¥‹
            document.getElementById('complaint-form').reset();
            APP_STATE.trackingId = newId;

            // é€™è£¡æ‡‰è©²æ›¿æ›æˆè‡ªè¨‚çš„æˆåŠŸè¨Šæ¯ Modal
            console.log(`ç”³è¨´æˆåŠŸï¼æ‚¨çš„è¿½è¹¤ ID æ˜¯ï¼š${newId}ã€‚è«‹å¦¥å–„ä¿å­˜ï¼`);
            
            // ç”±æ–¼ä¸èƒ½ä½¿ç”¨ alert()ï¼Œé€™è£¡å°‡æˆåŠŸè¨Šæ¯ç›´æ¥é¡¯ç¤ºåœ¨ç•«é¢é ‚éƒ¨
            const successMessage = document.createElement('div');
            successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-xl z-50';
            successMessage.textContent = `âœ… ç”³è¨´æˆåŠŸï¼è¿½è¹¤ IDï¼š${newId}`;
            document.body.appendChild(successMessage);
            setTimeout(() => successMessage.remove(), 5000);


            showComplaintSection('track');
            document.getElementById('track-id').value = newId;
            handleTrackingSubmit({ preventDefault: () => {} }); // è‡ªå‹•è¿½è¹¤
            // ----------------------------------------
        }

        // ç”³è¨´è¿½è¹¤æŸ¥è©¢è™•ç†
        function handleTrackingSubmit(event) {
            event.preventDefault();
            const trackId = document.getElementById('track-id').value.toUpperCase();
            const resultDiv = document.getElementById('tracking-result');
            
            // --- API æ›¿æ›é»: GET /api/complaints/:id ---
            const caseData = APP_STATE.mockData.complaints[trackId];

            if (!caseData) {
                resultDiv.innerHTML = `<p class="text-red-600 font-semibold mt-4">æŸ¥ç„¡æ­¤æ¡ˆä»¶ ID æˆ–æ¡ˆä»¶å·²éæœŸã€‚</p>`;
                return;
            }
            // ----------------------------------------

            const steps = ['å·²æ”¶åˆ°', 'è™•ç†ä¸­', 'å·²å›è¦†', 'å·²çµæ¡ˆ'];
            const currentStatusIndex = steps.indexOf(caseData.status);

            const stepsHtml = steps.map((step, index) => `
                <div class="status-step flex-1 text-center ${index <= currentStatusIndex ? 'active' : ''}">
                    <div class="status-dot w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center ${index < currentStatusIndex ? 'bg-phsa-red' : index === currentStatusIndex ? 'bg-phsa-red/50' : 'bg-gray-200'}">
                        <i data-lucide="${index === 0 ? 'inbox' : index === 1 ? 'loader' : index === 2 ? 'message-square' : 'check-circle'}" class="w-4 h-4 text-white"></i>
                    </div>
                    <p class="status-text text-sm text-gray-500">${step}</p>
                </div>
            `).join(`
                <div class="flex-1 h-1 bg-gray-200 mt-4"></div>
            `);

            resultDiv.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-xl font-bold mb-2">æ¡ˆä»¶ ID: ${trackId}</h3>
                    <p class="text-lg text-gray-700">é¡åˆ¥: ${caseData.category}</p>
                    <p class="text-lg text-gray-700">ç›®å‰ç‹€æ…‹: 
                        <span class="font-semibold ${caseData.status === 'å·²çµæ¡ˆ' ? 'text-green-600' : caseData.status === 'è™•ç†ä¸­' ? 'text-yellow-600' : 'text-red-600'}">
                            ${caseData.status}
                        </span>
                    </p>
                </div>

                <!-- ç‹€æ…‹é€²åº¦æ¢ -->
                <div class="flex items-start justify-between mb-8">
                    ${stepsHtml}
                </div>
                
                <!-- ç”³è¨´å…§å®¹èˆ‡å›è¦† -->
                <div class="bg-gray-100 p-4 rounded-lg">
                    <p class="font-semibold mb-2">æ‚¨æäº¤çš„å…§å®¹ï¼š</p>
                    <p class="text-gray-700 italic">${caseData.content}</p>
                </div>
                ${caseData.adminReply ? `
                    <div class="bg-phsa-blue/10 border-l-4 border-phsa-blue p-4 rounded-lg mt-4">
                        <p class="font-semibold text-phsa-blue mb-2">å­¸ç”Ÿæœƒ/æ¬Šè²¬å–®ä½å›è¦†ï¼š</p>
                        <p class="text-gray-800">${caseData.adminReply}</p>
                    </div>
                ` : '<p class="mt-4 text-gray-500">æ¬Šç›Šçµ„æ­£åœ¨ç©æ¥µè™•ç†ä¸­ï¼Œè«‹è€å¿ƒç­‰å€™å›è¦†...</p>'}
            `;
            lucide.createIcons();
        }

        // ç¤¾åœ˜ç¯©é¸
        function filterClubs(category) {
            // é€™è£¡å¯ä»¥å¯¦ç¾å‰ç«¯ç¯©é¸é‚è¼¯ï¼Œæˆ–è§¸ç™¼ API è«‹æ±‚
            console.log(`æ¨¡æ“¬ç¯©é¸ç¤¾åœ˜ï¼Œç¯©é¸é¡åˆ¥: ${category}`);
        }

        // å¹¹éƒ¨ç™»å…¥ï¼ˆä½¿ç”¨ Firebase Email/Password é©—è­‰ï¼‰
        async function handleAdminLogin(event) {
            event.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const messageEl = document.getElementById('login-message');
            
            messageEl.textContent = 'ç™»å…¥ä¸­...';
            messageEl.classList.remove('text-red-500', 'text-green-500');

            try {
                // 1. å˜—è©¦ä½¿ç”¨ Email/Password ç™»å…¥ Firebase
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                
                // 2. ç¢ºèªç™»å…¥çš„ç”¨æˆ¶æ˜¯å¦ç‚ºç®¡ç†å“¡ Email
                if (userCredential.user.email === ADMIN_EMAIL) {
                    // ç™»å…¥æˆåŠŸä¸”æ˜¯ç®¡ç†å“¡
                    APP_STATE.isAdmin = true;
                    messageEl.textContent = 'ç™»å…¥æˆåŠŸï¼';
                    messageEl.classList.remove('text-red-500');
                    messageEl.classList.add('text-green-500');
                    // navigate æœƒç”± onAuthStateChanged ç›£è½å™¨é–“æ¥è§¸ç™¼ï¼Œä½†é€™è£¡ç›´æ¥å°èˆªæ›´å¿«
                    setTimeout(() => navigate('admin'), 500);
                } else {
                    // ç™»å…¥æˆåŠŸä½†ä¸æ˜¯é æœŸçš„ç®¡ç†å“¡å¸³è™Ÿ (ä¾‹å¦‚ï¼šæ™®é€šå­¸ç”Ÿå¸³è™Ÿ)
                    await signOut(auth); // ç™»å‡ºé€™å€‹éç®¡ç†å“¡å¸³è™Ÿ
                    messageEl.textContent = 'å¸³è™Ÿæ¬Šé™ä¸è¶³ã€‚';
                }
            } catch (error) {
                // ç™»å…¥å¤±æ•—
                console.error("Login failed:", error);
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    messageEl.textContent = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€‚';
                } else if (error.code === 'auth/network-request-failed') {
                    messageEl.textContent = 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£ç·šã€‚';
                } else {
                    messageEl.textContent = `ç™»å…¥å¤±æ•—ï¼š${error.message}`;
                }
                messageEl.classList.remove('text-green-500');
                messageEl.classList.add('text-red-500');
            }
        }

        // å¹¹éƒ¨ç™»å‡º
        function handleAdminLogout() {
            signOut(auth).then(() => {
                APP_STATE.isAdmin = false;
                navigate('home');
                // é€™è£¡æ‡‰è©²æ›¿æ›æˆè‡ªè¨‚çš„æˆåŠŸè¨Šæ¯ Modal
                console.log('æ‚¨å·²å®‰å…¨ç™»å‡ºã€‚');
                
                const successMessage = document.createElement('div');
                successMessage.className = 'fixed top-4 right-4 bg-gray-500 text-white p-4 rounded-lg shadow-xl z-50';
                successMessage.textContent = 'ğŸšª æ‚¨å·²å®‰å…¨ç™»å‡ºã€‚';
                document.body.appendChild(successMessage);
                setTimeout(() => successMessage.remove(), 3000);

            }).catch((error) => {
                console.error("Logout failed:", error);
            });
        }

        // å°‡å‡½å¼æ›è¼‰åˆ° window ç‰©ä»¶ï¼Œè®“ HTML ä¸­çš„ onclick å¯ä»¥å‘¼å«
        window.navigate = navigate;
        window.showComplaintSection = showComplaintSection;
        window.handleComplaintSubmit = handleComplaintSubmit;
        window.handleTrackingSubmit = handleTrackingSubmit;
        window.filterClubs = filterClubs;
        window.handleAdminLogin = handleAdminLogin;
        window.handleAdminLogout = handleAdminLogout;

        // Mobile Menu Toggler
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            if (menuButton) {
                menuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            // åˆå§‹å•Ÿå‹• Firebase å’Œèº«ä»½é©—è­‰æµç¨‹
            initFirebaseAndAuth();
        });

        // PWA å»ºè­°ï¼šService Worker è¨»å†Š (æ­¤è™•ç‚ºæ¨¡æ“¬æç¤º)
        if ('serviceWorker' in navigator) {
            setTimeout(() => {
                console.log('TODO: è¨»å†Š Service Worker å¯¦ç¾ PWA å¿«å–ã€‚');
            }, 3000);
        }
    </script>
</body>
</html>
