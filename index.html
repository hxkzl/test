<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ | PKSH Student Council</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        theme: {
                            DEFAULT: '#00c8b7',
                            dark: '#00a092',
                            light: '#e0fbf9'
                        },
                        gemini: {
                            start: '#4E8cff',
                            end: '#E04f5f'
                        }
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --primary-color: #00c8b7;
            font-family: 'Noto Sans TC', 'Inter', system-ui, sans-serif;
        }
        
        .text-theme { color: var(--primary-color); }
        .bg-theme { background-color: var(--primary-color); }
        .border-theme { border-color: var(--primary-color); }
        
        /* è·‘é¦¬ç‡ˆ */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 30s linear infinite; }
        .marquee-content:hover { animation-play-state: paused; }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* æœå°‹è¦–çª—éæ¸¡ */
        #search-modal { transition: opacity 0.3s ease-in-out; }
        
        /* Gemini æ¼¸å±¤ */
        .bg-gradient-gemini {
            background: linear-gradient(135deg, #4E8cff, #E04f5f);
        }

        /* èŠå¤©è¦–çª—å‹•ç•« */
        #gemini-chat-window { transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; }
        .chat-bubble { max-width: 80%; padding: 10px 14px; border-radius: 12px; font-size: 0.95rem; line-height: 1.4; word-wrap: break-word;}
        .chat-user { background-color: #00c8b7; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-ai { background-color: #f3f4f6; color: #1f2937; align-self: flex-start; border-bottom-left-radius: 2px; }
        .dark .chat-ai { background-color: #374151; color: #e5e7eb; }

        body, div, nav, header { transition: background-color 0.3s, color 0.3s; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 flex flex-col min-h-screen">

    <div class="bg-gray-800 text-white dark:bg-black text-sm py-2 px-4 marquee-container">
        <div class="marquee-content" id="marquee-text"></div>
    </div>

    <header class="sticky top-0 z-30 bg-white/95 backdrop-blur shadow-sm dark:bg-gray-800/95 dark:border-b dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="#" class="flex-shrink-0 flex items-center gap-2" onclick="navigate('home')">
                    <img src="https://ui-avatars.com/api/?name=PK&background=00c8b7&color=fff&size=128" alt="PKSH Logo" class="w-10 h-10 rounded-full bg-white dark:bg-gray-700 p-0.5 shadow-sm object-cover">
                    <span class="text-xl font-bold text-gray-900 dark:text-white hidden sm:block">åŒ—æ¸¯é«˜ä¸­<span class="text-theme">å­¸ç”Ÿæœƒ</span></span>
                </a>

                <nav class="hidden xl:flex space-x-1 items-center overflow-x-auto">
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('home')" data-key="home">é¦–é </button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('events')" data-key="events">è¿‘æœŸæ´»å‹•</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('clubs')" data-key="clubs">ç¤¾åœ˜å°ˆå€</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('mailboxes')" data-key="mailboxes">ä¿¡ç®±å°ˆå€</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('finance')" data-key="finance">è²¡å‹™æ˜ç´°</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('meetings')" data-key="meetings">æœƒè­°ç´€éŒ„</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition whitespace-nowrap" onclick="navigate('org')" data-key="org">çµ„ç¹”æ¶æ§‹</button>
                    <button class="nav-btn px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition text-theme font-semibold whitespace-nowrap" onclick="navigate('contact')" data-key="contact">è¯çµ¡æˆ‘å€‘</button>
                </nav>

                <div class="flex items-center space-x-2 flex-shrink-0">
                    <button onclick="toggleSearch()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-200 transition">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                    <button onclick="toggleLang()" class="px-2 py-1 text-xs font-bold border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <span id="lang-display">EN</span>
                    </button>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-yellow-400 transition">
                        <i data-lucide="moon" id="dark-icon" class="w-5 h-5"></i>
                        <i data-lucide="sun" id="light-icon" class="w-5 h-5 hidden"></i>
                    </button>
                    <button id="menu-button" class="xl:hidden text-gray-600 dark:text-gray-200 p-2">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="mobile-menu" class="xl:hidden hidden bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 absolute w-full z-40 shadow-xl overflow-y-auto max-h-[80vh]">
            <div class="px-4 pt-2 pb-4 space-y-1">
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('home')" data-key="home">é¦–é </button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('events')" data-key="events">è¿‘æœŸæ´»å‹•</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('clubs')" data-key="clubs">ç¤¾åœ˜å°ˆå€</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('mailboxes')" data-key="mailboxes">ä¿¡ç®±å°ˆå€</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('finance')" data-key="finance">è²¡å‹™æ˜ç´°</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('meetings')" data-key="meetings">æœƒè­°ç´€éŒ„</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700" onclick="navigate('org')" data-key="org">çµ„ç¹”æ¶æ§‹</button>
                <button class="block w-full text-left py-3 px-3 rounded-md font-medium hover:bg-gray-50 dark:hover:bg-gray-700 text-theme" onclick="navigate('contact')" data-key="contact">è¯çµ¡æˆ‘å€‘</button>
            </div>
        </div>
    </header>

    <div id="search-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden flex flex-col pt-20 px-4 items-center">
        <div class="w-full max-w-2xl relative">
            <input type="text" id="search-input" class="w-full bg-white dark:bg-gray-800 text-xl p-4 rounded-xl shadow-2xl dark:text-white border-2 border-theme focus:outline-none" placeholder="è¼¸å…¥é—œéµå­—æœå°‹..." onkeyup="performSearch()">
            <button onclick="toggleSearch()" class="absolute right-4 top-4 text-gray-500 hover:text-red-500">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div id="search-results" class="w-full max-w-2xl mt-4 space-y-2 overflow-y-auto max-h-[70vh] pb-10"></div>
    </div>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-4">
        <div id="gemini-chat-window" class="w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 hidden transform origin-bottom-right scale-90 opacity-0 flex flex-col max-h-[500px]">
            <div class="bg-gradient-gemini p-4 rounded-t-2xl flex justify-between items-center text-white">
                <div class="flex items-center gap-2"><i data-lucide="sparkles" class="w-5 h-5"></i><span class="font-bold">Gemini æ™ºæ…§åŠ©æ‰‹</span></div>
                <button onclick="toggleGemini()" class="hover:text-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="gemini-messages" class="flex-grow p-4 overflow-y-auto space-y-3 bg-gray-50 dark:bg-gray-900 h-80">
                </div>
            <div class="p-3 border-t dark:border-gray-700 bg-white dark:bg-gray-800 rounded-b-2xl flex gap-2">
                <input type="text" id="gemini-input" placeholder="è¼¸å…¥è¨Šæ¯..." class="flex-grow p-2 rounded-lg border dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-400" onkeypress="handleGeminiEnter(event)">
                <button onclick="sendGeminiMessage()" class="bg-gradient-gemini p-2 rounded-lg text-white hover:opacity-90 transition transform active:scale-95"><i data-lucide="send" class="w-5 h-5"></i></button>
            </div>
        </div>
        <button onclick="toggleGemini()" class="bg-white dark:bg-gray-800 p-3 rounded-full shadow-xl border border-gray-100 dark:border-gray-600 group hover:scale-110 transition duration-300">
            <div class="bg-gradient-gemini p-3 rounded-full text-white shadow-lg animate-bounce-slow"><i data-lucide="bot" class="w-8 h-8"></i></div>
        </button>
    </div>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex-grow w-full" id="app-container">
        <div id="loading-spinner" class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-theme"></div>
        </div>
    </main>

    <footer class="bg-gray-100 dark:bg-gray-800 mt-auto py-8 border-t dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500 dark:text-gray-400">
            <p class="font-bold text-lg mb-4 text-theme">PKSH Student Council</p>
            
            <div class="flex justify-center items-center gap-6 mb-4">
                <a href="https://www.instagram.com/pksh.su/" target="_blank" class="hover:text-pink-600 transition flex flex-col items-center gap-1">
                    <i data-lucide="instagram" class="w-6 h-6"></i>
                    <span class="text-xs">å­¸ç”Ÿæœƒ IG</span>
                </a>
                <a href="https://www.facebook.com/52PKSH/?locale=zh_TW" target="_blank" class="hover:text-blue-600 transition flex flex-col items-center gap-1">
                    <i data-lucide="facebook" class="w-6 h-6"></i>
                    <span class="text-xs">å­¸æ ¡ FB</span>
                </a>
                <a href="https://www.pksh.ylc.edu.tw/home" target="_blank" class="hover:text-theme transition flex flex-col items-center gap-1">
                    <i data-lucide="globe" class="w-6 h-6"></i>
                    <span class="text-xs">å­¸æ ¡å®˜ç¶²</span>
                </a>
            </div>
            
            <p>Â© 2025 åœ‹ç«‹åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒ. All Rights Reserved.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const I18N = {
            zh: {
                home: 'é¦–é ', events: 'è¿‘æœŸæ´»å‹•', mailboxes: 'ä¿¡ç®±å°ˆå€', clubs: 'ç¤¾åœ˜å°ˆå€', 
                contact: 'è¯çµ¡æˆ‘å€‘', org: 'çµ„ç¹”æ¶æ§‹', finance: 'è²¡å‹™æ˜ç´°', meetings: 'æœƒè­°ç´€éŒ„', admin: 'å¹¹éƒ¨ç™»å…¥',
                marquee: 'æ­¡è¿ä¾†åˆ°åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒï¼ 12/24(ä¸‰) é‡‘å‹¾ç›ƒæ´»å‹• â€¢ 1/16-20 ç¬¬ä¸‰æ¬¡æ®µè€ƒ â€¢ å‚³æƒ…æ´»å‹•ç†±çƒˆé€²è¡Œä¸­ï¼',
                heroTitle: 'åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒäº’å‹•ç¶²ç«™',
                heroSubtitle: 'ä½ çš„è²éŸ³ï¼Œæˆ‘å€‘çš„è¡Œå‹•ã€‚å…±å‰µæ›´ç¾å¥½çš„æ ¡åœ’ç”Ÿæ´»ã€‚',
                btnComplaint: 'å‰å¾€ä¿¡ç®±å°ˆå€',
                news: 'æœ€æ–°å…¬å‘Š',
                confession: 'åŒ¿åå‘Šç™½ç‰†',
                financeTitle: 'è²¡å‹™æ˜ç´°',
                orgTitle: 'å­¸ç”Ÿæœƒçµ„ç¹”æ¶æ§‹',
                eventTitle: 'è¿‘æœŸæ´»å‹•ä¸€è¦½',
                meetingTitle: 'æœƒè­°è¨˜éŒ„å­˜æª”',
                clubTitle: 'ç¤¾åœ˜å°ˆå€',
                rightsMailbox: 'å­¸æ¬Šä¿¡ç®±', rightsDesc: 'ç™¼ç¾æ ¡åœ’è¨­å‚™æå£ã€å°å­¸æ ¡æ”¿ç­–æœ‰ç–‘å•æˆ–å»ºè­°ï¼Ÿè«‹å¡«å¯«æ­¤è¡¨å–®ï¼Œå­¸æ¬Šçµ„å°‡ç‚ºæ‚¨çˆ­å–æ¬Šç›Šã€‚',
                anonMailbox: 'åŒ¿åä¿¡ç®±', anonDesc: 'å¿ƒæƒ…æŠ’ç™¼ã€æƒ³å°å­¸ç”Ÿæœƒèªªæ‚„æ‚„è©±ï¼Ÿé€™è£¡æ˜¯çµ•å°ä¿å¯†çš„æ¨¹æ´ã€‚',
                goToForm: 'å‰å¾€å¡«å¯«è¡¨å–®', searchPlaceholder: 'è¼¸å…¥é—œéµå­—æœå°‹å…¬å‘Šæˆ–æ´»å‹•...', noResults: 'æ²’æœ‰æ‰¾åˆ°ç›¸é—œçµæœ',
                col_date: 'æ—¥æœŸ', col_item: 'é …ç›®', col_amount: 'é‡‘é¡',
                role_pres: 'æœƒé•·', role_vp: 'å‰¯æœƒé•·', role_admin: 'è¡Œæ”¿çµ„', role_act: 'æ´»å‹•çµ„', role_mobile: 'æ©Ÿå‹•çµ„',
                role_pr: 'å…¬é—œçµ„', role_ga: 'ç¸½å‹™çµ„', role_art: 'ç¾å®£çµ„', role_chief: 'çµ„é•·', role_deputy: 'å‰¯çµ„é•·',
                write_confession: 'æˆ‘è¦å‘Šç™½', submit: 'é€å‡º', placeholder_confession: 'å¯«ä¸‹ä½ æƒ³èªªçš„è©±...'
            },
            en: {
                home: 'Home', events: 'Events', mailboxes: 'Mailboxes', clubs: 'Clubs',
                contact: 'Contact Us', org: 'Organization', finance: 'Finance', meetings: 'Meeting Minutes', admin: 'Staff Login',
                marquee: 'Welcome to PKSH Student Council! 12/24 Xmas Event â€¢ 1/16-20 3rd Midterm Exam â€¢ Message Delivery Event Ongoing!',
                heroTitle: 'PKSH Student Council Interactive Site',
                heroSubtitle: 'Your Voice, Our Action. Creating a better campus life together.',
                btnComplaint: 'Go to Mailboxes',
                news: 'Latest News',
                confession: 'Confession Wall',
                financeTitle: 'Financial Details',
                orgTitle: 'Organizational Chart',
                eventTitle: 'Upcoming Events',
                meetingTitle: 'Meeting Minutes Archive',
                clubTitle: 'Student Clubs',
                rightsMailbox: 'Student Rights Mailbox', rightsDesc: 'Report damaged facilities or suggest policy changes. The Student Rights Dept will fight for you.',
                anonMailbox: 'Anonymous Mailbox', anonDesc: 'Share your feelings or whisper to the Student Council. This is a confidential space.',
                goToForm: 'Fill out Form', searchPlaceholder: 'Search news or events...', noResults: 'No results found',
                col_date: 'Date', col_item: 'Item', col_amount: 'Amount',
                role_pres: 'President', role_vp: 'Vice President', role_admin: 'Administrative Dept', role_act: 'Activity Dept', role_mobile: 'Logistics Dept',
                role_pr: 'Public Relations', role_ga: 'General Affairs', role_art: 'Art & Design', role_chief: 'Chief', role_deputy: 'Deputy',
                write_confession: 'Write Confession', submit: 'Submit', placeholder_confession: 'Write something...'
            }
        };

        const APP_STATE = {
            view: 'home',
            lang: 'zh',
            darkMode: false,
            userId: null,
            // è¼ªæ’­è¨ˆæ™‚å™¨
            confessionTimer: null,
            confessionIndex: 0,
            // AI è¨˜æ†¶
            chatHistory: [
                { role: 'ai', text: 'å—¨ï¼æˆ‘æ˜¯åŒ—æ¸¯é«˜ä¸­çš„ AI åŠ©æ‰‹ã€‚è«‹å•ä»Šå¤©æœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«æ‚¨çš„å—ï¼Ÿâœ¨' }
            ],
            mockData: {
                // é¦–é å…¬å‘Š
                announcements: [
                    { 
                        id: 1, 
                        title_zh: '114å­¸å¹´åº¦é‡‘å‹¾ç›ƒæ­Œå”±æ¯”è³½æ™‚ç¨‹è¡¨', 
                        title_en: '114th Golden Hook Cup Singing Contest Schedule', 
                        tag_zh: 'æ´»å‹•', 
                        tag_en: 'Event', 
                        date: '2025-12-24',
                        content_zh: `
                            <div class="mt-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-4 group cursor-pointer hover:bg-red-100 dark:hover:bg-red-900/40 transition">
                                <div class="bg-red-500 text-white p-3 rounded-lg">
                                    <i data-lucide="file-text" class="w-6 h-6"></i>
                                </div>
                                <div class="flex-grow">
                                    <h4 class="font-bold text-red-800 dark:text-red-300">é‡‘å‹¾ç›ƒè³½ç¨‹è¡¨.pdf</h4>
                                    <p class="text-xs text-red-600 dark:text-red-400">å¤§å°: 1.2 MB â€¢ é»æ“Šä¸‹è¼‰</p>
                                </div>
                                <i data-lucide="download" class="w-5 h-5 text-red-400 group-hover:text-red-600"></i>
                            </div>
                        `
                    }
                ],
                // å‘Šç™½ç‰†æ¨¡æ“¬è³‡æ–™
                confessionWall: [
                    { content: "å‚³æƒ…çš„å·§å…‹åŠ›çœŸçš„å¾ˆå¥½åƒï¼Œè¬è¬å­¸å§Šï¼", author: "é«˜ä¸€çš„å°æ˜" },
                    { content: "é‡‘å‹¾ç›ƒå¤§å®¶åŠ æ²¹ï¼æœŸå¾…ç¥ç§˜å˜‰è³“ï¼", author: "è·¯éçš„åŒå­¸" },
                    { content: "å¤©æ°£è®Šå†·äº†ï¼Œå¤§å®¶è¦æ³¨æ„ä¿æš–å–”ï½", author: "æš–æš–åŒ…" },
                    { content: "å­¸ç”Ÿæœƒè¾›è‹¦äº†ï¼Œæ´»å‹•è¾¦å¾—å¾ˆæ£’ï¼", author: "é«˜ä¸‰è€å±è‚¡" },
                    { content: "å¸Œæœ›èƒ½å¤šè¾¦ä¸€é»æ ¡éš›äº¤æµæ´»å‹•ï¼", author: "æƒ³äº¤æœ‹å‹çš„äºº" }
                ],
                events: [
                    { date: '12/24', title_zh: 'é‡‘å‹¾ç›ƒæ­Œå”±å¤§è³½', title_en: 'Jingle Bell Singing Contest', location_zh: 'æ´»å‹•ä¸­å¿ƒ', location_en: 'Activity Center', time: '13:00', type: 'Entertainment' },
                    { date: '01/16', title_zh: 'ç¬¬ä¸‰æ¬¡æ®µè€ƒ Day1', title_en: '3rd Midterm Exam Day 1', location_zh: 'å„ç­æ•™å®¤', location_en: 'Classrooms', time: '08:00', type: 'Academic' },
                ],
                finance: [
                    { item_zh: 'è–èª•æ´»å‹•ä½ˆç½®è²»', item_en: 'Xmas Decoration', amount: -5000, date: '2025-12-15', type: 'Out' },
                    { item_zh: 'å‚³æƒ…å¡ç‰‡ç¾©è³£æ”¶å…¥', item_en: 'Card Sale Income', amount: 8500, date: '2025-12-18', type: 'In' },
                ],
                // çµ„ç¹”æˆå“¡ (è‹±æ–‡å§“åæ”¹ç‚ºå¨å¦¥ç‘ªæ‹¼éŸ³)
                orgLeaders: [
                    { roleKey: 'role_pres', icon: 'ğŸ‘‘', name_zh: 'å¼µä½¾å‚‘', name_en: 'Chang I-Chieh', desc_zh: 'å°å…§ç¶œç†å…§å‹™ï¼Œä¸»æŒå¬é–‹æœƒå“¡ä»£è¡¨å¤§æœƒï¼Œå°å¤–ä»£è¡¨æœ¬æœƒï¼Œé…åˆå­¸æ ¡æ¨å±•å„é …æ´»å‹•ä¸¦è² è²¬ç¶œç†æœ¬æœƒäº‹å®œã€‚', desc_en: 'Manages internal affairs, presides over general assembly meetings, represents the council externally, and oversees council matters in cooperation with school activities.' },
                    { roleKey: 'role_vp', icon: 'â­', name_zh: 'ç‹é›…ç', name_en: 'Wang Ya-Min', desc_zh: 'å”åŠ©æœƒé•·åŸ·è¡Œæœ¬æœƒäº‹å®œï¼Œæœƒé•·å› æ•…ç¼ºå¸­æ™‚ä»£ç†ä¹‹ã€‚', desc_en: 'Assists the President in executing council matters and acts on behalf of the President in their absence.' }
                ],
                orgDepts: [
                    { roleKey: 'role_act', icon: 'ğŸ‰', chief: 'é„­é›¨æ¶µ', chief_en: 'Cheng Yu-Han', deputy: '', deputy_en: '', desc_zh: 'è² è²¬ç­–åŠƒåŠæ¨è¡Œæœ¬æœƒæ‰€èˆ‰è¾¦ä¹‹å„é¡æ´»å‹•ã€‚', desc_en: 'Responsible for planning and implementing various activities organized by the council.' },
                    { roleKey: 'role_art', icon: 'ğŸ¨', chief: 'æœ±å®ˆæ™´', chief_en: 'Chu Shou-Ching', deputy: 'é»ƒç“Šç¾', deputy_en: 'Huang Chiung-Mei', desc_zh: 'è² è²¬æœ¬æœƒå­¸è—æ´»å‹•ã€æµ·å ±ã€å£å ±è¨­è¨ˆã€‚', desc_en: 'Responsible for art activities, poster design, and wall newspaper design.' },
                    { roleKey: 'role_admin', icon: 'ğŸ“', chief: 'è”¡ç§‰å®', chief_en: 'Tsai Ping-Hung', deputy: 'é¡å­ä’Ÿ', deputy_en: 'Yen Tzu-Tan', desc_zh: 'è² è²¬æœ¬æœƒé–‹æœƒé€šå‘Šã€æœƒè­°è¨˜éŒ„åŠè³‡æ–™ä¹‹æ”¶é›†æ•´ç†ã€‚', desc_en: 'Responsible for meeting notices, recording minutes, and collecting/organizing data. Consists of one chief and several members.' },
                    { roleKey: 'role_ga', icon: 'ğŸ’°', chief: 'è¶™èŠç¿Š', chief_en: 'Chao Chih-I', deputy: '', deputy_en: '', desc_zh: 'è² è²¬æœ¬æœƒç¶“è²»æ”¶æ”¯ï¼Œè²¡ç”¢ä¿ç®¡ã€‚', desc_en: 'Responsible for the councilâ€™s financial income/expenditure and property custody.' },
                    { roleKey: 'role_pr', icon: 'ğŸ“¢', chief: 'è¨±é›…ç³', chief_en: 'Hsu Ya-Lin', deputy: '', deputy_en: '', desc_zh: 'è² è²¬æœ¬æœƒæœƒè­°ä¹‹è¯çµ¡åŠèˆ‰è¾¦æ´»å‹•ä¹‹è¯ç¹«ï¼Œå°å¤–è² è²¬å…¬å…±é—œä¿‚ä¹‹è·å‹™ã€‚', desc_en: 'Responsible for liaison of meetings and activities, and external public relations duties.' },
                    { roleKey: 'role_mobile', icon: 'ğŸ› ï¸', chief: 'åŠ‰ä¹™è‘­', chief_en: 'Liu I-Chia', deputy: '', deputy_en: '', desc_zh: 'è² è²¬æœ¬æœƒèˆ‰è¾¦ä¹‹å ´åœ°ä½ˆç½®ï¼ŒåŠå…¶ä»–æœå‹™äº‹é …ã€‚', desc_en: 'Responsible for venue decoration for council events and other service matters.' }
                ],
                clubs: [
                    { name_zh: 'ç†±èˆç¤¾', name_en: 'Pop Dance Club', category: 'Dance', bg: 'FF5733', abbr: 'PDC', ig: 'https://www.instagram.com/pkdc.20_flaming/' },
                    { name_zh: 'ç†±éŸ³ç¤¾', name_en: 'Pop Music Club', category: 'Music', bg: '3357FF', abbr: 'PMC', ig: 'https://www.instagram.com/pkhmc_/' },
                    { name_zh: 'ç«¥è»ç¤¾', name_en: 'Scout Club', category: 'Service', bg: '28B463', abbr: 'SC', ig: 'https://www.instagram.com/pksh_circus_scout/' },
                ],
                meetings: [
                    { date: '2025-11-05', title_zh: 'æœŸä¸­ç¤¾åœ˜é•·å¤§æœƒæœƒè­°è¨˜éŒ„', title_en: 'Mid-term Club Leaders Meeting Minutes' },
                    { date: '2025-10-20', title_zh: 'æ ¡æ…¶ç±Œå‚™ç¬¬äºŒæ¬¡æœƒè­°', title_en: '2nd Anniversary Prep Meeting' },
                    { date: '2025-09-15', title_zh: 'ç¬¬å…­å±†ç¬¬ä¸€æ¬¡ä¾‹æœƒè¨˜éŒ„', title_en: '6th Session 1st Regular Meeting' }
                ]
            }
        };

        const firebaseConfig = { apiKey: "mock", authDomain: "mock" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        signInAnonymously(auth).catch(e => console.log("Auth placeholder"));
        onAuthStateChanged(auth, (user) => {
            APP_STATE.userId = user ? user.uid : null;
            document.getElementById('loading-spinner')?.remove();
            render();
            renderChatHistory(); // æ¢å¾©å°è©±ç´€éŒ„
        });

        const t = (key) => I18N[APP_STATE.lang][key] || key;
        const isEn = () => APP_STATE.lang === 'en';

        function updateMarquee() {
            const el = document.getElementById('marquee-text');
            if(el) el.innerText = t('marquee');
        }

        window.toggleSearch = () => {
            const modal = document.getElementById('search-modal');
            const input = document.getElementById('search-input');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                input.focus();
                input.placeholder = t('searchPlaceholder');
            } else {
                modal.classList.add('hidden');
                document.getElementById('search-results').innerHTML = '';
                input.value = '';
            }
        };

        window.performSearch = () => {
            const query = document.getElementById('search-input').value.toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            if (query.length < 2) {
                resultsDiv.innerHTML = '';
                return;
            }
            const hits = [];
            APP_STATE.mockData.announcements.forEach(a => {
                const title = isEn() ? a.title_en : a.title_zh;
                if (title.toLowerCase().includes(query)) hits.push({ type: isEn()?'News':'å…¬å‘Š', title: title, date: a.date, icon: 'bell' });
            });
            APP_STATE.mockData.events.forEach(e => {
                const title = isEn() ? e.title_en : e.title_zh;
                if (title.toLowerCase().includes(query)) hits.push({ type: isEn()?'Event':'æ´»å‹•', title: title, date: e.date, icon: 'calendar' });
            });
            if (hits.length === 0) {
                resultsDiv.innerHTML = `<div class="text-center text-white text-lg mt-10">${t('noResults')}</div>`;
            } else {
                resultsDiv.innerHTML = hits.map(h => `
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg flex items-center gap-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <div class="bg-theme/20 p-2 rounded-full text-theme"><i data-lucide="${h.icon}"></i></div>
                        <div>
                            <p class="font-bold dark:text-white">${h.title}</p>
                            <span class="text-xs bg-gray-200 dark:bg-gray-600 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300">${h.type}</span>
                            <span class="text-xs text-gray-400 ml-2">${h.date}</span>
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
            }
        };

        window.toggleGemini = () => {
            const window = document.getElementById('gemini-chat-window');
            if (window.classList.contains('hidden')) {
                window.classList.remove('hidden');
                setTimeout(() => {
                    window.classList.remove('scale-90', 'opacity-0');
                    window.classList.add('scale-100', 'opacity-100');
                    renderChatHistory(); // ç¢ºä¿æ‰“é–‹æ™‚é¡¯ç¤ºç´€éŒ„
                }, 10);
            } else {
                window.classList.remove('scale-100', 'opacity-100');
                window.classList.add('scale-90', 'opacity-0');
                setTimeout(() => window.classList.add('hidden'), 300);
            }
        };

        window.handleGeminiEnter = (e) => {
            if (e.key === 'Enter') sendGeminiMessage();
        };

        function renderChatHistory() {
            const container = document.getElementById('gemini-messages');
            if(!container) return;
            container.innerHTML = APP_STATE.chatHistory.map(msg => `
                <div class="chat-bubble ${msg.role === 'user' ? 'chat-user w-fit ml-auto' : 'chat-ai w-fit mr-auto'} mb-2">
                    ${marked.parse(msg.text)}
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        window.sendGeminiMessage = () => {
            const input = document.getElementById('gemini-input');
            const msg = input.value.trim();
            if(!msg) return;
            
            // 1. æ–°å¢ä½¿ç”¨è€…è¨Šæ¯
            APP_STATE.chatHistory.push({ role: 'user', text: msg });
            renderChatHistory();
            input.value = '';

            const container = document.getElementById('gemini-messages');
            const loadingId = 'loading-' + Date.now();
            container.innerHTML += `<div id="${loadingId}" class="chat-bubble chat-ai w-fit mr-auto mb-2 italic text-gray-400">æ€è€ƒä¸­...</div>`;
            container.scrollTop = container.scrollHeight;

            // 2. æ¨¡æ“¬ AI å›æ‡‰é‚è¼¯ (å¢å¼·ç‰ˆ)
            setTimeout(() => {
                document.getElementById(loadingId).remove();
                let reply = generateAIResponse(msg);
                
                APP_STATE.chatHistory.push({ role: 'ai', text: reply });
                renderChatHistory();
            }, 800);
        };

        // ç°¡å–®çš„ AI é—œéµå­—å›æ‡‰é‚è¼¯èˆ‡è¨˜æ†¶è™•ç†
        function generateAIResponse(msg) {
            const lowerMsg = msg.toLowerCase();
            
            // ä¸Šä¸‹æ–‡æª¢æŸ¥ (ç°¡å–®å¯¦ä½œï¼šæª¢æŸ¥æœ€å¾Œä¸€å‰‡ AI è¨Šæ¯æ˜¯å¦æ˜¯å•é¡Œ)
            const lastAiMsg = APP_STATE.chatHistory.filter(m => m.role === 'ai').pop()?.text || "";

            if (lowerMsg.includes('æ´»å‹•') || lowerMsg.includes('event')) {
                return "è¿‘æœŸæœ‰ **é‡‘å‹¾ç›ƒæ­Œå”±å¤§è³½ (12/24)** å’Œ **ç¬¬ä¸‰æ¬¡æ®µè€ƒ (1/16)**ï¼è©³ç´°å…§å®¹å¯ä»¥å»ã€Œè¿‘æœŸæ´»å‹•ã€é é¢æŸ¥çœ‹å–”ã€‚ğŸ¤";
            }
            if (lowerMsg.includes('ç¤¾åœ˜') || lowerMsg.includes('club')) {
                return "åŒ—æ¸¯é«˜ä¸­æœ‰å¾ˆå¤šå¾ˆæ£’çš„ç¤¾åœ˜ï¼Œåƒæ˜¯**ç†±èˆç¤¾**ã€**ç†±éŸ³ç¤¾**å’Œ**ç«¥è»ç¤¾**ï¼ä½ æƒ³äº†è§£å“ªä¸€å€‹é¡å‹çš„ç¤¾åœ˜å‘¢ï¼ŸğŸ•º";
            }
            if (lowerMsg.includes('æœƒé•·') || lowerMsg.includes('president')) {
                return "æœ¬å±†å­¸ç”Ÿæœƒæœƒé•·æ˜¯ **å¼µä½¾å‚‘ (Chang I-Chieh)**ï¼Œå‰¯æœƒé•·æ˜¯ **ç‹é›…ç (Wang Ya-Min)**ã€‚æˆ‘å€‘è‡´åŠ›æ–¼ç‚ºå¤§å®¶æœå‹™ï¼ğŸ¤";
            }
            if (lowerMsg.includes('å‘Šç™½') || lowerMsg.includes('confession')) {
                return "æƒ³å‘Šç™½å—ï¼Ÿé¦–é æœ‰**å‘Šç™½ç‰†**ï¼Œæˆ–è€…ä½ å¯ä»¥å»ã€Œä¿¡ç®±å°ˆå€ã€å¡«å¯«åŒ¿åè¡¨å–®å–”ï¼ğŸ’Œ";
            }
            if (lowerMsg.includes('è¬è¬') || lowerMsg.includes('thank')) {
                return "ä¸å®¢æ°£ï¼å¾ˆé«˜èˆˆèƒ½å¹«åˆ°ä½ ã€‚é‚„æœ‰å…¶ä»–å•é¡Œå—ï¼ŸğŸ˜Š";
            }
            if (lowerMsg.includes('ä½ å¥½') || lowerMsg.includes('hi') || lowerMsg.includes('hello')) {
                return "å—¨ï¼ä½ å¥½å‘€ï¼ä»Šå¤©éå¾—å¦‚ä½•ï¼ŸğŸ‘‹";
            }
            
            // é è¨­å›æ‡‰
            return "æˆ‘æ˜¯åŒ—æ¸¯é«˜ä¸­å­¸ç”Ÿæœƒçš„ AI åŠ©æ‰‹ã€‚é›–ç„¶æˆ‘é‚„åœ¨å­¸ç¿’ä¸­ï¼Œä½†æˆ‘å¯ä»¥å¹«ä½ æŸ¥è©¢**æ´»å‹•**ã€**ç¤¾åœ˜**ã€**çµ„ç¹”**ç­‰è³‡è¨Šã€‚ä½ å¯ä»¥è©¦è‘—å•æˆ‘ï¼šã€Œæœ€è¿‘æœ‰ä»€éº¼æ´»å‹•ï¼Ÿã€ğŸ¤–";
        }

        // æ¨¡æ“¬å‘Šç™½é€å‡ºåŠŸèƒ½
        window.submitConfession = () => {
            const input = document.getElementById('confession-input');
            if(!input || !input.value.trim()) return;

            const newConfession = {
                content: input.value.trim(),
                author: "å‰›å‰›çš„åŒå­¸" // æ¨¡æ“¬åŒ¿å
            };

            // 1. æ›´æ–°è³‡æ–™
            APP_STATE.mockData.confessionWall.unshift(newConfession);
            
            // 2. æ¸…ç©ºè¼¸å…¥æ¡†
            input.value = '';

            // 3. ç«‹å³é‡è¨­ä¸¦é¡¯ç¤ºæœ€æ–°ä¸€å‰‡
            APP_STATE.confessionIndex = 0;
            const elContent = document.getElementById('confession-content');
            const elAuthor = document.getElementById('confession-author');
            
            if(elContent && elAuthor) {
                // å¼·åˆ¶è§¸ç™¼é‡ç¹ª
                elContent.style.opacity = 0;
                elAuthor.style.opacity = 0;
                setTimeout(() => {
                    elContent.innerText = `"${newConfession.content}"`;
                    elAuthor.innerText = `- ${newConfession.author}`;
                    elContent.style.opacity = 1;
                    elAuthor.style.opacity = 1;
                }, 100);
            }

            // 4. é‡ç½®è¨ˆæ™‚å™¨ï¼Œé¿å…é¦¬ä¸Šåˆ‡æ›
            if (APP_STATE.confessionTimer) clearInterval(APP_STATE.confessionTimer);
            APP_STATE.confessionTimer = setInterval(updateConfessionDisplay, 5000);

            alert(isEn() ? "Confession Submitted!" : "å‘Šç™½å·²é€å‡ºï¼æœƒç«‹å³å‡ºç¾åœ¨ç‰†ä¸Šå–”ï¼");
        };

        function startConfessionCarousel() {
            if (APP_STATE.confessionTimer) clearInterval(APP_STATE.confessionTimer);
            updateConfessionDisplay();
            APP_STATE.confessionTimer = setInterval(updateConfessionDisplay, 5000);
        }

        function updateConfessionDisplay() {
            const elContent = document.getElementById('confession-content');
            const elAuthor = document.getElementById('confession-author');
            if(!elContent || !elAuthor) return;

            const data = APP_STATE.mockData.confessionWall[APP_STATE.confessionIndex];
            
            elContent.classList.remove('animate-fade-in');
            elContent.style.opacity = 0;
            elAuthor.style.opacity = 0;
            
            setTimeout(() => {
                elContent.innerText = `"${data.content}"`;
                elAuthor.innerText = `- ${data.author}`;
                elContent.style.opacity = 1;
                elAuthor.style.opacity = 1;
                elContent.classList.add('animate-fade-in');
                elAuthor.style.opacity = 0.8;
            }, 300);

            APP_STATE.confessionIndex = (APP_STATE.confessionIndex + 1) % APP_STATE.mockData.confessionWall.length;
        }

        function renderHome() {
            const announcements = APP_STATE.mockData.announcements;
            const newsHtml = announcements.map(item => `
                <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md hover:shadow-lg transition border-l-4 border-theme">
                    <span class="text-xs font-bold text-theme uppercase">${isEn() ? item.tag_en : item.tag_zh}</span>
                    <h3 class="text-lg font-bold mt-1 dark:text-white">${isEn() ? item.title_en : item.title_zh}</h3>
                    <p class="text-sm text-gray-400 mt-1 mb-2">${item.date}</p>
                    ${item.content_zh ? `<div class="mt-2 text-gray-600 dark:text-gray-300 overflow-x-auto">${item.content_zh}</div>` : ''}
                </div>
            `).join('');

            return `
                <div class="bg-theme text-white rounded-2xl p-8 mb-10 shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <h1 class="text-4xl font-extrabold mb-4">${t('heroTitle')}</h1>
                        <p class="text-lg opacity-90">${t('heroSubtitle')}</p>
                        <button class="mt-6 bg-white text-theme font-bold py-3 px-8 rounded-full hover:bg-gray-100 transition" onclick="navigate('mailboxes')">
                            ${t('btnComplaint')}
                        </button>
                    </div>
                    <div class="absolute right-0 bottom-0 opacity-10 transform translate-x-10 translate-y-10"><i data-lucide="school" class="w-64 h-64"></i></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-6">
                        <h2 class="text-2xl font-bold dark:text-white flex items-center gap-2 mb-4">
                            <i data-lucide="newspaper" class="text-theme"></i>
                            ${t('news')}
                        </h2>
                        <div class="space-y-4">
                            ${newsHtml}
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="bg-gradient-to-br from-pink-400 to-red-500 rounded-2xl p-6 text-white shadow-lg sticky top-24 flex flex-col h-fit">
                            <div class="flex items-center gap-2 mb-4">
                                <i data-lucide="heart" class="fill-current animate-pulse"></i>
                                <h3 class="text-xl font-bold">${t('confession')}</h3>
                            </div>
                            <div class="flex-grow flex flex-col justify-center min-h-[100px] mb-4">
                                <p id="confession-content" class="text-lg font-medium italic mb-2 transition-opacity duration-500">"Loading..."</p>
                                <p id="confession-author" class="text-sm text-right opacity-80 transition-opacity duration-500">- ...</p>
                            </div>
                            
                            <div class="mt-auto bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                                <input type="text" id="confession-input" class="w-full bg-transparent border-b border-white/50 text-white placeholder-white/70 px-2 py-1 focus:outline-none focus:border-white text-sm mb-2" placeholder="${t('placeholder_confession')}">
                                <button class="bg-white text-pink-500 hover:bg-gray-100 w-full py-1.5 rounded-md text-sm font-bold transition shadow-sm" onclick="submitConfession()">
                                    ${t('submit')}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderEvents() {
            const events = APP_STATE.mockData.events;
            const html = events.map(e => `
                <div class="flex flex-col md:flex-row bg-white dark:bg-gray-800 rounded-xl shadow overflow-hidden hover:shadow-md transition group">
                    <div class="bg-theme text-white p-6 flex flex-col justify-center items-center md:w-32 flex-shrink-0">
                        <span class="text-3xl font-bold">${e.date.split('/')[1]}</span>
                        <span class="text-sm uppercase opacity-80">${e.date.split('/')[0]}æœˆ</span>
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-center border-l-0 md:border-l dark:border-gray-700">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-theme transition">${isEn() ? e.title_en : e.title_zh}</h3>
                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-xs rounded text-gray-500 dark:text-gray-300">${e.type}</span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-4 h-4"></i> ${e.time}</span>
                            <span class="flex items-center gap-1"><i data-lucide="map-pin" class="w-4 h-4"></i> ${isEn() ? e.location_en : e.location_zh}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
                <h1 class="text-3xl font-bold mb-8 text-gray-800 dark:text-white flex items-center gap-2">
                    <i data-lucide="calendar" class="text-theme"></i> ${t('eventTitle')}
                </h1>
                <div class="space-y-4">
                    ${html}
                </div>
            `;
        }

        function renderMailboxes() {
            return `
                 <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden border-t-4 border-blue-500">
                        <div class="p-8">
                            <div class="bg-blue-100 dark:bg-blue-900/30 w-16 h-16 rounded-full flex items-center justify-center mb-6 text-blue-600 dark:text-blue-400">
                                <i data-lucide="scale" class="w-8 h-8"></i>
                            </div>
                            <h2 class="text-2xl font-bold mb-4 dark:text-white">${t('rightsMailbox')}</h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-8 leading-relaxed">
                                ${t('rightsDesc')}
                            </p>
                            <a href="https://forms.google.com/placeholder-rights" target="_blank" class="block w-full bg-blue-500 hover:bg-blue-600 text-white text-center font-bold py-4 rounded-xl transition transform hover:-translate-y-1 shadow-lg shadow-blue-500/30">
                                ${t('goToForm')} <i data-lucide="external-link" class="inline w-4 h-4 ml-1"></i>
                            </a>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden border-t-4 border-pink-500">
                        <div class="p-8">
                            <div class="bg-pink-100 dark:bg-pink-900/30 w-16 h-16 rounded-full flex items-center justify-center mb-6 text-pink-600 dark:text-pink-400">
                                <i data-lucide="message-circle-heart" class="w-8 h-8"></i>
                            </div>
                            <h2 class="text-2xl font-bold mb-4 dark:text-white">${t('anonMailbox')}</h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-8 leading-relaxed">
                                ${t('anonDesc')}
                            </p>
                            <a href="https://forms.google.com/placeholder-anon" target="_blank" class="block w-full bg-pink-500 hover:bg-pink-600 text-white text-center font-bold py-4 rounded-xl transition transform hover:-translate-y-1 shadow-lg shadow-pink-500/30">
                                ${t('goToForm')} <i data-lucide="external-link" class="inline w-4 h-4 ml-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderClubs() {
            const clubs = APP_STATE.mockData.clubs;
            // ä½¿ç”¨ ui-avatars ç”Ÿæˆæ›´å…·è­˜åˆ¥åº¦çš„å¤§é ­è²¼ï¼Œä¾æ“šé¡è‰²å’Œç¸®å¯«
            const html = clubs.map(c => `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl transition group flex flex-col">
                    <div class="h-48 bg-gray-200 dark:bg-gray-700 relative overflow-hidden">
                        <img src="https://ui-avatars.com/api/?name=${c.abbr}&background=${c.bg}&color=fff&size=256&font-size=0.4" alt="${c.name_zh}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                        <div class="absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur">
                            ${c.category}
                        </div>
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold dark:text-white mb-1">${isEn() ? c.name_en : c.name_zh}</h3>
                        <div class="mt-auto pt-4">
                            <a href="${c.ig}" target="_blank" class="flex items-center justify-center gap-2 w-full border border-gray-200 dark:border-gray-600 py-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300 transition">
                                <i data-lucide="instagram" class="w-4 h-4"></i> Visit IG
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
                <h1 class="text-3xl font-bold mb-8 text-gray-800 dark:text-white flex items-center gap-2">
                    <i data-lucide="users" class="text-theme"></i> ${t('clubTitle')}
                </h1>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${html}
                </div>
            `;
        }

        function renderFinance() {
            const data = APP_STATE.mockData.finance;
            const rows = data.map(row => {
                const isIncome = row.type === 'In';
                const colorClass = isIncome ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
                const sign = isIncome ? '+' : '';
                return `
                    <tr class="border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition">
                        <td class="p-4 text-gray-600 dark:text-gray-300">${row.date}</td>
                        <td class="p-4 font-medium dark:text-white">${isEn() ? row.item_en : row.item_zh}</td>
                        <td class="p-4 text-right font-bold ${colorClass}">${sign}${row.amount.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');

            return `
                <h1 class="text-3xl font-bold mb-8 text-gray-800 dark:text-white flex items-center gap-2">
                    <i data-lucide="piggy-bank" class="text-theme"></i> ${t('financeTitle')}
                </h1>
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-300 uppercase text-xs">
                                <tr>
                                    <th class="p-4 w-32">${t('col_date')}</th>
                                    <th class="p-4">${t('col_item')}</th>
                                    <th class="p-4 text-right w-32">${t('col_amount')}</th>
                                </tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderMeetings() {
            const meetings = APP_STATE.mockData.meetings;
            const html = meetings.map(m => `
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow flex justify-between items-center group cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition border-l-4 border-transparent hover:border-theme">
                    <div class="flex items-center gap-4">
                        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-full text-gray-500 dark:text-gray-300">
                            <i data-lucide="file-text"></i>
                        </div>
                        <div>
                            <h3 class="font-bold dark:text-white text-lg">${isEn() ? m.title_en : m.title_zh}</h3>
                            <p class="text-sm text-gray-400">${m.date}</p>
                        </div>
                    </div>
                    <button class="text-gray-400 group-hover:text-theme transition">
                        <i data-lucide="download" class="w-5 h-5"></i>
                    </button>
                </div>
            `).join('');

            return `
                <h1 class="text-3xl font-bold mb-8 text-gray-800 dark:text-white flex items-center gap-2">
                    <i data-lucide="clipboard-list" class="text-theme"></i> ${t('meetingTitle')}
                </h1>
                <div class="space-y-4 max-w-4xl mx-auto">
                    ${html}
                </div>
            `;
        }

        function renderOrg() {
            // æ­£å‰¯æœƒé•·
            const leadersHtml = APP_STATE.mockData.orgLeaders.map(p => `
                 <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 text-center relative overflow-hidden group border-t-4 ${p.roleKey === 'role_pres' ? 'border-yellow-400' : 'border-gray-400'}">
                    <div class="text-6xl mb-4 transform group-hover:scale-110 transition">${p.icon}</div>
                    <h3 class="text-2xl font-bold dark:text-white mb-1">${isEn() ? p.name_en : p.name_zh}</h3>
                    <div class="text-theme font-semibold uppercase tracking-wide text-sm mb-4">${t(p.roleKey)}</div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm leading-relaxed">${isEn() ? p.desc_en : p.desc_zh}</p>
                 </div>
            `).join('');

            // å„çµ„
            const deptsHtml = APP_STATE.mockData.orgDepts.map(d => `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow hover:shadow-lg transition">
                    <div class="flex items-center gap-3 mb-3 pb-3 border-b dark:border-gray-700">
                        <span class="text-2xl">${d.icon}</span>
                        <h4 class="text-lg font-bold dark:text-white">${t(d.roleKey)}</h4>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">${t('role_chief')}</span>
                            <span class="font-medium dark:text-gray-200">${isEn() ? d.chief_en : d.chief}</span>
                        </div>
                        ${d.deputy ? `
                        <div class="flex justify-between">
                            <span class="text-gray-400">${t('role_deputy')}</span>
                            <span class="font-medium dark:text-gray-200">${isEn() ? d.deputy_en : d.deputy}</span>
                        </div>` : ''}
                    </div>
                    <p class="mt-4 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/50 p-2 rounded">
                        ${isEn() ? d.desc_en : d.desc_zh}
                    </p>
                </div>
            `).join('');

            return `
                <h1 class="text-3xl font-bold mb-10 text-center dark:text-white">${t('orgTitle')}</h1>
                
                <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto mb-16">
                    ${leadersHtml}
                </div>

                <div class="relative mb-8">
                    <div class="absolute inset-0 flex items-center" aria-hidden="true">
                        <div class="w-full border-t border-gray-300 dark:border-gray-700"></div>
                    </div>
                    <div class="relative flex justify-center">
                        <span class="bg-gray-50 dark:bg-gray-900 px-3 text-lg font-medium text-gray-900 dark:text-gray-100">Departments</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${deptsHtml}
                </div>
            `;
        }

        function renderContact() {
            return `
                <div class="max-w-3xl mx-auto text-center py-10">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 md:p-12">
                        <h2 class="text-3xl font-bold text-theme mb-6">${t('contact')}</h2>
                        <div class="space-y-6">
                            <div class="flex flex-col items-center">
                                <div class="bg-theme/10 p-4 rounded-full text-theme mb-2"><i data-lucide="map-pin" class="w-8 h-8"></i></div>
                                <p class="text-gray-600 dark:text-gray-300 text-lg">é›²æ—ç¸£åŒ—æ¸¯é®æˆåŠŸè·¯26è™Ÿ (å­¸å‹™è™•)</p>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="bg-theme/10 p-4 rounded-full text-theme mb-2"><i data-lucide="mail" class="w-8 h-8"></i></div>
                                <p class="text-gray-600 dark:text-gray-300 text-lg">pkshsa@pksh.ylc.edu.tw</p>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="bg-theme/10 p-4 rounded-full text-theme mb-2"><i data-lucide="phone" class="w-8 h-8"></i></div>
                                <p class="text-gray-600 dark:text-gray-300 text-lg">05-783-2246</p>
                            </div>
                        </div>
                        <div class="mt-10 pt-8 border-t dark:border-gray-700">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3652.569476735639!2d120.3039763154316!3d23.57157898467778!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x346ebd8a31e8c459%3A0x8849646487e387c6!2z5ZyL56uL5YyX5riv6auY57Sa5Lit5a245aC0!5e0!3m2!1szh-TW!2stw!4v1679061234567!5m2!1szh-TW!2stw" width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded-lg shadow-inner"></iframe>
                        </div>
                    </div>
                </div>
            `;
        }

        window.navigate = (view) => {
            APP_STATE.view = view;
            
            // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const key = btn.dataset.key;
                if (key === view) {
                    btn.classList.add('text-theme', 'font-bold', 'bg-gray-50', 'dark:bg-gray-800');
                    btn.classList.remove('text-gray-600');
                } else {
                    btn.classList.remove('text-theme', 'font-bold', 'bg-gray-50', 'dark:bg-gray-800');
                }
            });

            // éš±è—æ‰‹æ©Ÿé¸å–®
            document.getElementById('mobile-menu').classList.add('hidden');
            
            // æ²å‹•åˆ°é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });

            render();
        };

        function render() {
            const container = document.getElementById('app-container');
            if (APP_STATE.confessionTimer) {
                clearInterval(APP_STATE.confessionTimer);
                APP_STATE.confessionTimer = null;
            }

            let content = '';
            switch(APP_STATE.view) {
                case 'home': content = renderHome(); break;
                case 'events': content = renderEvents(); break;
                case 'mailboxes': content = renderMailboxes(); break;
                case 'finance': content = renderFinance(); break;
                case 'meetings': content = renderMeetings(); break;
                case 'clubs': content = renderClubs(); break;
                case 'org': content = renderOrg(); break;
                case 'contact': content = renderContact(); break;
                default: content = renderHome();
            }
            
            // æ·¡å…¥å‹•ç•«æ•ˆæœ
            container.style.opacity = '0';
            setTimeout(() => {
                container.innerHTML = content;
                lucide.createIcons();
                container.style.opacity = '1';
                container.style.transition = 'opacity 0.3s ease-in-out';
                
                // é¦–é ç‰¹å®šé‚è¼¯
                if(APP_STATE.view === 'home' || !APP_STATE.view) {
                    startConfessionCarousel();
                }
            }, 150);
        }

        window.toggleDarkMode = () => {
            APP_STATE.darkMode = !APP_STATE.darkMode;
            const html = document.documentElement;
            if(APP_STATE.darkMode) {
                html.classList.add('dark');
                document.getElementById('dark-icon').classList.add('hidden');
                document.getElementById('light-icon').classList.remove('hidden');
            } else {
                html.classList.remove('dark');
                document.getElementById('dark-icon').classList.remove('hidden');
                document.getElementById('light-icon').classList.add('hidden');
            }
            localStorage.setItem('pksh_theme', APP_STATE.darkMode ? 'dark' : 'light');
        };

        window.toggleLang = () => {
            APP_STATE.lang = APP_STATE.lang === 'zh' ? 'en' : 'zh';
            document.getElementById('lang-display').innerText = APP_STATE.lang === 'zh' ? 'EN' : 'ä¸­';
            updateMarquee();
            // æ›´æ–°å°èˆªæ–‡å­—
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.innerText = t(btn.dataset.key);
            });
            // æ›´æ–°æ‰‹æ©Ÿé¸å–®æ–‡å­—
            document.querySelectorAll('#mobile-menu button[data-key]').forEach(btn => {
                btn.innerText = t(btn.dataset.key);
            });
            render();
        };

        const menuBtn = document.getElementById('menu-button');
        menuBtn.addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // åˆå§‹åŒ–
        (function init() {
            // è®€å–ä¸»é¡Œè¨­å®š
            const savedTheme = localStorage.getItem('pksh_theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                APP_STATE.darkMode = true;
                document.documentElement.classList.add('dark');
                document.getElementById('dark-icon').classList.add('hidden');
                document.getElementById('light-icon').classList.remove('hidden');
            }
            
            updateMarquee();
            // åˆå§‹è·¯ç”±
            navigate('home');
        })();

    </script>
</body>
</html>

